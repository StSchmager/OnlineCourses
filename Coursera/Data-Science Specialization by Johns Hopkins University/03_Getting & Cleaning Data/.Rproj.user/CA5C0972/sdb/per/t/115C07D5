{
    "contents" : "# Raw-data main folder is working directory\n\nfolder <- \"C:/Users/Stefan/Google Drive/Projects/2 ZIP Code Analysis/1 Raw Data/Stores 1-9\"\nsetwd(folder)\nsubfolders <- list.files()\n\n# Loop through sub-folders in raw-data main folder\n\nfor (j in 1:length(subfolders)) {\n      \n# Raw-data sub-folders become working directories one after another\n      \nsetwd(paste0(folder, \"/\", subfolders[j]))\nfile_list <- list.files()\n\n# Data-frame list is created\ndf_list <- list()\nlength(df_list) <- length(file_list)\nnames(df_list) <- seq(1:length(df_list))\n\n# Loop through each file in each sub-folder and read Excel spreadsheet as a data frame and...\n# Add it as an element to the data-frame list\nlibrary(xlsx)\nfor (i in 1:length(file_list)) {\n            \n      df_list[[i]] <- cbind(read.xlsx(file_list[i], sheetIndex = 1,\n                                     startRow = 15, colIndex = c(3, 5:7, 11, 13), header = T,\n                                     colClasses = c(\"integer\", \"character\", \"character\", \"integer\", \"numeric\", \"numeric\")),\n                            read.xlsx(file_list[i], sheetIndex = 1,\n                                     startRow = 12, endRow = 12, colIndex = 8, header = F,\n                                     colClasses = c(\"character\")))\n}\n\n# Convert the data-frame list into one data set by row-binding the list elements / data frames\nlibrary(plyr)\ndat <- ldply(df_list, data.frame)\n\n# Remove the data-frame and file list, as well as the for-loop index since not needed anymore\nrm(df_list, file_list, i)\n\n# Remove data rows and columns that don't contain valuable information\ndat <- dat[complete.cases(dat),]\nrow.names(dat) <- NULL\n\n# Label data columns\ncolnames(dat) <- c(\"Store\", \"ZIP_Code_int\", \"City\", \"State\", \"Visits\", \"Avg_Basket_Size\", \"Total_Sales\", \"Period\")\n\n# Specify column classes\ndat$Store <- factor(dat$Store)\ndat$ZIP_Code_fac <- factor(as.character(dat$ZIP_Code_int))\ndat$City <- factor(as.character(dat$City))\ndat$State <- factor(as.character(dat$State))\ndat$Visits <- as.integer(dat$Visits)\ndat$Avg_Basket_Size <- as.numeric(dat$Avg_Basket_Size)\ndat$Total_Sales <- as.numeric(dat$Total_Sales)\ndat$Period <- factor(dat$Period)\n\ndat$Store <- factor(dat$Store,\n                    levels = c(\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\"),\n                    labels = c(\"1 (57th)\", \"2 (47th)\", \"3 (43rd)\", \"4 (WL)\", \"5 (118th)\",\n                               \"6 (Cermak)\", \"7 (Sibley)\", \"8 (95th)\", \"9 (OBT)\"))\n\n# Correct report error and remove negative values\ndat$Visits <- abs(dat$Visits)\ndat$Avg_Basket_Size <- abs(dat$Avg_Basket_Size)\ndat$Total_Sales <- abs(dat$Total_Sales)\n\n# Add new variable: Visits as percentage of total visits\n\n#Visits_Percentage <- tapply(dat$Visits, dat$Store, function(x) prop.table(as.matrix(x), margin = 2), simplify = F)\nVisits_Percentage <- by(dat$Visits, dat$Store, function(x) {x/sum(x)})\ndat$Visits_Percentage <- unlist(Visits_Percentage)\n\n## Save as csv. file in another directory\nsetwd(\"C:/Users/Stefan/Google Drive/Projects/2 ZIP Code Analysis/2 Processed Data\")\nwrite.csv(dat, paste0(\"2 Processed Data - ZIP Codes_Stores 1-9 - \", subfolders[j], \".csv\"), row.names = F)\n\n} # End of sub-folder loop.\n\nsetwd(\"C:/Users/Stefan/Google Drive/Projects/2 ZIP Code Analysis/2 Processed Data\")\n\ndat <- rbind(read.csv(\"2 Processed Data - ZIP Codes_Stores 1-9 - 2014 (whole year).csv\"),\n             read.csv(\"2 Processed Data - ZIP Codes_Stores 1-9 - 2015 (through 1-18).csv\"))\n\ndat$ZIP_Code_fac <- factor(as.character(dat$ZIP_Code_fac))\n\n# Determine whether ZIP code is part of the Chicago DMA ZIP Codes, thus, is relevant and add indicator variable\nDMA <- read.csv(\"2 Processed Data - ZIP Codes (Valassis).csv\")\ndat$DMA_ZIP_Code <- dat$ZIP_Code_int %in% DMA$ZIP_Code\n\n# Determine whether ZIP code is an official US ZIP Codes and not an arbitrary number; add indicator variable\nsetwd(\"C:/Users/Stefan/Google Drive/Projects/2 ZIP Code Analysis/1 Raw Data/Valassis\")\nUS <- read.xlsx(\"Valassis_All US ZIP Code_01-19-15.xls\", sheetIndex = 1, colClasses = \"character\")\ndat$US_ZIP_Code <- dat$ZIP_Code_fac %in% US$ZIP\n\n# Save new file\nsetwd(\"C:/Users/Stefan/Google Drive/Projects/2 ZIP Code Analysis/2 Processed Data\")\nwrite.csv(dat, \"2 Processed Data - ZIP Codes (Stores 1-9).csv\", row.names = F)",
    "created" : 1421698649697.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2741312317",
    "id" : "115C07D5",
    "lastKnownWriteTime" : 1421784732,
    "path" : "C:/Users/Stefan/Google Drive/Projects/2 ZIP Code Analysis/2 Processed Data/1 DP - ZIP Codes (Stores 1-9).R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 0,
    "source_on_save" : false,
    "type" : "r_source"
}